<!DOCTYPE html>
<html lang="en" data-theme="night">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VishPro Agent</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-base-300 text-base-content">

  <!-- Header -->
  <header class="navbar bg-base-200 border-b border-base-content/10 px-4 min-h-14 gap-2">
    <div class="navbar-start gap-3">
      <img src="icon-128.png" alt="VishPro" class="w-8 h-8 rounded-lg shrink-0">
      <div class="min-w-0">
        <h1 id="headerTitle" class="text-[15px] font-semibold leading-tight truncate">VishPro</h1>
        <div class="flex items-center gap-1.5 text-xs opacity-50">
          <span class="status-dot shrink-0" id="statusDot"></span>
          <span id="statusText" class="truncate">Ready</span>
        </div>
      </div>
    </div>
    <div class="navbar-end gap-1">
      <button id="historyToggle" class="btn btn-ghost btn-sm btn-square" title="Data & History">
        <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
        </svg>
      </button>
      <button id="settingsToggle" class="btn btn-ghost btn-sm btn-square" title="Settings">
        <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Settings Panel -->
  <div class="hidden bg-base-200 border-b border-base-content/10 overflow-hidden" id="settingsPanel">
    <div class="p-4 space-y-4">
      <!-- Settings Tabs -->
      <div role="tablist" class="tabs tabs-boxed bg-base-300 settings-tabs">
        <button role="tab" class="tab tab-active text-xs font-medium" data-settings-tab="models">
          <svg class="w-3.5 h-3.5 mr-1.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
          </svg>
          Models
        </button>
        <button role="tab" class="tab text-xs font-medium" data-settings-tab="ui">
          <svg class="w-3.5 h-3.5 mr-1.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/>
          </svg>
          Interface
        </button>
      </div>

      <!-- Models Tab Content -->
      <div id="settingsModelsTab" class="settings-tab-content">
        <label class="form-control w-full mb-3">
          <div class="label"><span class="label-text text-xs font-medium opacity-70">OpenRouter API Key</span></div>
          <label class="input input-bordered flex items-center gap-2">
            <input type="password" id="openrouterApiKey" class="grow" placeholder="sk-or-...">
            <span id="openrouterApiKeyStatus" class="text-sm"></span>
          </label>
        </label>
        <div class="text-xs opacity-60 mb-3">Get key from <a href="https://openrouter.ai/keys" target="_blank" class="link link-primary">openrouter.ai/keys</a></div>

        <div id="modelsBody" class="space-y-3">
          <div class="tier-section" data-tier="HIGH">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-error badge-sm">HIGH</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="HIGH" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListHigh"></ul>
          </div>
          <div class="tier-section" data-tier="MEDIUM">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-warning badge-sm">MEDIUM</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="MEDIUM" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListMedium"></ul>
          </div>
          <div class="tier-section" data-tier="LOW">
            <div class="flex items-center justify-between mb-2">
              <span class="badge badge-success badge-sm">LOW</span>
              <button class="btn btn-ghost btn-xs btn-square tier-add-btn" data-tier="LOW" title="Add model">+</button>
            </div>
            <ul class="list bg-base-300 rounded-lg min-h-10" id="modelListLow"></ul>
          </div>
        </div>
        <div class="flex justify-end pt-2 border-t border-base-content/10">
          <button class="btn btn-ghost btn-sm" id="resetModelsBtn">Reset to Defaults</button>
        </div>
      </div>

      <!-- UI Tab Content -->
      <div id="settingsUiTab" class="settings-tab-content hidden">
        <!-- Theme Selection -->
        <div class="ui-control-card bg-base-300 rounded-xl p-4 mb-3">
          <div class="text-sm font-medium mb-3">Theme</div>
          <div id="themeSelector" class="grid grid-cols-4 gap-2">
            <button class="theme-btn flex flex-col items-center gap-1.5 p-2 rounded-lg border-2 border-transparent" data-theme="cupcake">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-200 to-pink-100 border-2 border-pink-300"></div>
              <span class="text-[10px] opacity-70">Cupcake</span>
            </button>
            <button class="theme-btn flex flex-col items-center gap-1.5 p-2 rounded-lg border-2 border-transparent" data-theme="retro">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-amber-200 to-orange-200 border-2 border-amber-400"></div>
              <span class="text-[10px] opacity-70">Retro</span>
            </button>
            <button class="theme-btn flex flex-col items-center gap-1.5 p-2 rounded-lg border-2 border-transparent" data-theme="sunset">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-400 to-rose-500 border-2 border-orange-500"></div>
              <span class="text-[10px] opacity-70">Sunset</span>
            </button>
            <button class="theme-btn flex flex-col items-center gap-1.5 p-2 rounded-lg border-2 border-transparent" data-theme="night">
              <div class="w-8 h-8 rounded-full bg-gradient-to-br from-slate-700 to-slate-900 border-2 border-indigo-500"></div>
              <span class="text-[10px] opacity-70">Night</span>
            </button>
          </div>
        </div>

        <!-- Zoom Controls -->
        <div class="ui-control-card bg-base-300 rounded-xl p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="text-sm font-medium">Zoom</div>
            <div class="flex items-center gap-1">
              <button id="zoomOut" class="btn btn-ghost btn-sm btn-square zoom-btn" title="Zoom out">−</button>
              <span id="zoomLevel" class="zoom-level-display text-sm font-mono min-w-14 text-center">100%</span>
              <button id="zoomIn" class="btn btn-ghost btn-sm btn-square zoom-btn" title="Zoom in">+</button>
            </div>
          </div>
          <input type="range" id="zoomSlider" min="75" max="150" value="100" step="5" class="range range-xs range-primary w-full">
          <div class="flex justify-between text-[10px] opacity-40 mt-1">
            <span>75%</span>
            <span>150%</span>
          </div>
        </div>

        <div class="flex justify-end pt-3">
          <button class="btn btn-ghost btn-sm" id="resetUiBtn">Reset to Defaults</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Extraction Panel -->
  <div class="hidden bg-base-200 border-b border-base-content/10 overflow-hidden" id="extractionPanel">
    <div class="p-4 max-h-[350px] overflow-y-auto">
      <div role="tablist" class="tabs tabs-boxed bg-base-300 mb-3">
        <button role="tab" class="tab tab-active text-xs" data-tab="current">Current</button>
        <button role="tab" class="tab text-xs" data-tab="history">History</button>
        <button role="tab" class="tab text-xs" data-tab="actions">Actions</button>
      </div>

      <div id="currentTabContent" class="tab-content">
        <button id="extractButton" class="btn btn-primary btn-sm w-full mb-3 gap-2">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Extract Page Data
        </button>
        <div id="currentTabExtractionContent"></div>
      </div>
      <div id="historyTabContent" class="tab-content hidden"></div>
      <div id="actionsTabContent" class="tab-content hidden"></div>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="flex-1 overflow-y-auto p-4 space-y-3" id="chatContainer">
    <div class="empty-state flex-1 flex flex-col items-center justify-center text-center py-8 opacity-50">
      <svg class="w-12 h-12 mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
      <p class="text-sm">Ready to help.<br>Ask me to interact with this page.</p>
    </div>
  </div>

  <!-- Input Area -->
  <div class="bg-base-200 border-t border-base-content/10 p-3">
    <div class="flex gap-2 items-end">
      <textarea id="messageInput" class="textarea textarea-bordered flex-1 min-h-[42px] max-h-[120px] text-sm resize-none leading-relaxed" placeholder="Read the page, click a button, fill a form..." rows="1"></textarea>
      <button id="sendButton" class="btn btn-primary btn-square" title="Send">
        <svg class="w-[18px] h-[18px]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
        </svg>
      </button>
    </div>
    <p class="text-[11px] opacity-40 text-center mt-2"><kbd class="kbd kbd-xs">Enter</kbd> to send · <kbd class="kbd kbd-xs">Shift+Enter</kbd> for new line</p>
  </div>

  <script src="sidepanel.js" type="module"></script>
</body>
</html>
